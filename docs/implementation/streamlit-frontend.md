# Streamlit フロントエンド

## 概要

RAGエージェントのチャットUIをStreamlitで構築する。
ユーザーがブラウザ上で質問を入力し、回答・出典・評価情報を確認できるようにする。

Streamlitを選んだ理由:
- Pythonだけで完結（HTML/CSS/JS不要）→ バックエンドと技術スタックが統一
- `st.chat_input` / `st.chat_message` でチャットUIが簡単に作れる
- FastAPIバックエンドとHTTPリクエストで疎結合に連携

## 構成

```
src/frontend/
└── app.py    # Streamlitアプリ本体（1ファイルで完結）
```

バックエンド（FastAPI）とフロントエンド（Streamlit）は別プロセスで起動し、
HTTPリクエスト（requests）で通信する。

```
ブラウザ → Streamlit (port 8501) → FastAPI (port 8000) → RAGエージェント
```

## 実装手順

### 1. ページ設定とサイドバー
- 目的: アプリのタイトル・レイアウトを設定し、接続状態を表示する
- やること: `st.set_page_config` でページ設定、サイドバーにヘルスチェック結果を表示
- 順序の理由: Streamlitはスクリプトを上から順に実行するため、ページ設定は最初に書く必要がある

### 2. セッション状態でチャット履歴を管理
- 目的: Streamlitはユーザー操作のたびにスクリプトを再実行するため、状態を保持する仕組みが必要
- やること: `st.session_state` にメッセージリストを保存
- ポイント: `st.session_state` はStreamlit固有の仕組みで、ページリロードまで状態が保持される

### 3. チャット履歴の表示
- 目的: 過去の質問と回答を画面に表示する
- やること: `st.chat_message` でロール（user/assistant）ごとにメッセージを描画

### 4. ユーザー入力の受付とAPI呼び出し
- 目的: 質問を受け取り、バックエンドのRAGエージェントに問い合わせる
- やること: `st.chat_input` で入力を受け取り、`requests.post` で `/api/query` を呼ぶ
- ポイント: `st.spinner` で処理中であることをユーザーに伝える

### 5. 回答の表示（出典・評価情報付き）
- 目的: 回答だけでなく、出典と評価情報を表示して透明性を確保する
- やること: 回答本文 + `st.expander` で出典一覧と評価情報を折りたたみ表示

## 判断理由

- **1ファイル構成にした理由**: チャットUIだけなので分割するほどの複雑さがない。シンプルさ優先
- **requestsで同期通信にした理由**: Streamlit自体が同期的にスクリプトを再実行するため、asyncは不要
- **サイドバーにヘルスチェックを置いた理由**: メインエリアはチャットに集中させ、システム状態は補助的に表示
